<html>
    <head>
        <title>Jersey City Parking Zons</title>
        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #map {
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>

        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js"></script>
        <script>
        var infoWindow, map;

        function toLatLng(arr) {
            var points = [];
            for (var i = 0; i < arr.length; i++) {
                var c = arr[i];
                var p = new google.maps.LatLng(c[0], c[1]);
                points.push(p);
            }
            return points;
        }

        function extend(bounds, points) {
            points.forEach(function(p) {
                bounds.extend(p);
            });
        }

        function initMap(zone_data) {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                mapTypeId: google.maps.MapTypeId.TERRAIN
            });
            infoWindow = new google.maps.InfoWindow;
            var bounds = new google.maps.LatLngBounds();

            zone_data.forEach(function(zone_info) {
                var color = '#'+Math.floor(Math.random() * 16777215).toString(16),
                    vertices = toLatLng(zone_info['hull']);

                if (vertices && vertices.length > 0) {
                    extend(bounds, vertices);
                    var poly = new google.maps.Polygon({
                        paths: vertices,
                        geodesic: true,
                        strokeColor: color,
                        strokeOpacity: 0.8,
                        strokeWeight: 3,
                        fillColor: color,
                        fillOpacity: 0.35
                    });
                    poly.setMap(map);
                    zone_info['polygon'] = poly;
                    addListenersOnPolygon(zone_info);
                }
            });

            map.setCenter(bounds.getCenter());
        }

        function addListenersOnPolygon(zone_info) {
          google.maps.event.addListener(zone_info['polygon'], 'click', function (event) {
            showInfo(zone_info, event);
          });
        }

        function showInfo(zone_info, event) {
            var geocodes = zone_info['geocoded'],
                vertices = zone_info['polygon'].getPath(),
                i;

            var contentString = '<strong>' + zone_info['zone'] + '</strong>';

            contentString += '<hr/><strong>Addrs:</strong>';

            for (i = 0; i < geocodes.length; i++) {
                var gc = geocodes[i];
                contentString += '<br/>' + gc[0] + ': ' + gc[1][0] + ',' + gc[1][1];
            }

            contentString += '<hr/><strong>Hulls:</strong>';

            for (i = 0; i < vertices.getLength(); i++) {
                var xy = vertices.getAt(i);
                contentString += '<br/>' + xy.lat() + ',' + xy.lng();
            }

            infoWindow.setContent(contentString);
            infoWindow.setPosition(event.latLng);
            infoWindow.open(map);
        };

        $(document).ready(function() {
          $.getJSON( "zone-permit-geocoded.json", function( data ) {
            initMap(data);
          });
        });
    </script>
  </body>
</html>
