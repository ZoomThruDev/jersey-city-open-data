<html>
    <head>
        <title>Jersey City Parking Zons</title>
        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #map {
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>

        <script>
        var zone1 = [
            '233--337 BARROW ST.',
            '19--151 BRIGHT ST.',
            '97--145 BRUNSWICK ST.',
            '19--31 COLDEN ST.',
            '1--37 COLES ST.',
            '73--103 COLGATE ST.',
            '95--273 COLUMBUS DR.',
            '292--444 FIRST ST.',
            '231--327 GROVE ST.',
            'ALL OF HAMPTON CT.',
            '419--543 JERSEY AVE.',
            '239--326 MARIN BLVD.',
            '1--45 MAXWELL AVE.',
            '1--222 MERCER ST.',
            '182 MERSELES ST.',
            '273--399 MONMOUTH ST.',
            '420 MONMOUTH ST.',
            '105--353 MONTGOMERY',
            '81--311 NEWARK AVE.',
            'ALL OF PAULMIER PL.',
            '321--463 SECOND ST.',
            '294--431 THIRD ST.',
            '245--355 VARICK ST.',
            '3--139 WAYNE ST.',
            '154--186 WAYNE ST.',
            '125--391 YORK ST.',
            ];

        var map;
        var infoWindow;
        var geocoder;
        var vertices;
        var bounds;

        function getAddresses(addrStr) {
            var addrs = addrStr.split('--');
            if (addrs.length == 1) {
                // No number range
                return addrs;
            }

            var streetPieces = addrs[1].split(' ');
            var street = streetPieces[1];

            return [
                addrs[0] + ' ' + street,
                streetPieces[0] + ' ' + street
            ];
        }

        function geoCode(geocoder, addr, vertices, bounds) {
            geocoder.geocode( { 'address': addr}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    // map.setCenter(results[0].geometry.location);
                    // var marker = new google.maps.Marker({
                    //     map: map,
                    //     position: results[0].geometry.location
                    // });
                    var lat = results[0].geometry.location.lat();
                    var lng = results[0].geometry.location.lng();
                    console.log(lat + ' ' + lng);
                    vertices.push({'lat': lat, 'lng': lng});
                    bounds.extend(results[0].geometry.location);
                    // console.log(vertices);
                } else {
                    console.log("Error looking up address: " + addr + " status: " + status);
                    // alert("Geocode was not successful for the following reason: " + status);
                }
            });
        }

        function getGeoCenter(points) {
            var sumLat = 0,
                sumLng = 0;

            for (var i = 0; i < points.length; i++) {
                sumLat += points[i].lat;
                sumLng += points[i].lng;
            }

            return {lat: sumLat/points.length, lng: sumLng/points.length};
        }

        function calculateAnglesFromCenter(points) {
            var center = getGeoCenter(points);

            for (var i = 0; i < points.length; i++) {
                points[i].angle = Math.atan2(points[i].lat - center.lat, points[i].lng - center.lng);
            }

            return points;
        }

        function initMap() {
            var SLEEP_STEP = 1000;
            geocoder = new google.maps.Geocoder;
            vertices = [];
            bounds = new google.maps.LatLngBounds();

          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            mapTypeId: google.maps.MapTypeId.TERRAIN
          });

          zone1.forEach(function(addrRow, idx) {
            setTimeout(function() {
                var addrs = getAddresses(addrRow);
                if (addrs.length > 1) {
                    geoCode(geocoder, addrs[0] + ' Jersey City, NJ', vertices, bounds);
                    geoCode(geocoder, addrs[1] + ' Jersey City, NJ', vertices, bounds);
                }
            }, SLEEP_STEP * idx);
          });

            setTimeout(function(){
                vertices = calculateAnglesFromCenter(vertices);
                console.log(vertices);

                vertices.sort(function(a, b) {
                    return a.angle - b.angle;
                });

                var poly = new google.maps.Polygon({
                    paths: vertices,
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 3,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35
                });
                poly.setMap(map);

                map.setCenter(bounds.getCenter());

                // Add a listener for the click event.
                poly.addListener('click', showArrays);
            }, SLEEP_STEP * zone1.length);

          infoWindow = new google.maps.InfoWindow;
        }

        function showArrays(event) {
          // Since this polygon has only one path, we can call getPath() to return the
          // MVCArray of LatLngs.
          var vertices = this.getPath();

          var contentString = '<b>Bermuda Triangle polygon</b><br>' +
              'Clicked location: <br>' + event.latLng.lat() + ',' + event.latLng.lng() +
              '<br>';

          // Iterate over the vertices.
          for (var i =0; i < vertices.getLength(); i++) {
            var xy = vertices.getAt(i);
            contentString += '<br>' + 'Coordinate ' + i + ':<br>' + xy.lat() + ',' +
                xy.lng();
          }

          // Replace the info window's content and position.
          infoWindow.setContent(contentString);
          infoWindow.setPosition(event.latLng);

          infoWindow.open(map);
        }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?signed_in=true&key=&callback=initMap"></script>
  </body>
</html>
